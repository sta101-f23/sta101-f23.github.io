{
  "hash": "79aa220db677636ad669bb3534a1b37b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Climate change\"\ncategories: \n  - Application exercise\nfig-width: 6\nfig-asp: 0.618\neditor_options: \n  chunk_output_type: console\n---\n\n\nIn this application exercise, we'll do inference for a comparing two paired means and many means.\n\n# Packages\n\nWe'll use the **tidyverse**, **tidymodels**, **openintro**, and **ggthemes** packages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\n```\n:::\n\n\n# Paired means\n\nThroughout this application exercise, we'll make use of the `climate70` dataset supplied by the **openintro** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(climate70)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 197\nColumns: 7\n$ station   <fct> USC00203823, USC00276818, USC00186620, USC00331890, USC00235…\n$ latitude  <dbl> 41.93520, 44.25800, 39.41317, 40.24030, 37.83950, 45.56550, …\n$ longitude <dbl> -84.64110, -71.25250, -79.40025, -81.87100, -94.37400, -100.…\n$ dx70_1948 <int> 131, 80, 143, 156, 216, 138, 131, 194, 198, 213, 224, 74, 17…\n$ dx70_2018 <int> 147, 99, 150, 158, 175, 132, 129, 188, 240, 213, 191, 101, 2…\n$ dx90_1948 <int> 11, 1, 4, 18, 59, 39, 23, 17, 46, 67, 49, 0, 34, 35, 71, 100…\n$ dx90_2018 <int> 16, 1, 1, 15, 51, 18, 17, 3, 65, 104, 39, 0, 62, 3, 86, 117,…\n```\n\n\n:::\n:::\n\n\nThe question we want to answer is: Do these data provide convincing evidence that the number of days above 90 degrees between 2018 and 1948?\n\nFirst, let's set the hypotheses.\n\n*Add response here.*\n\nTo carry out inference on paired data, we pre-compute the difference between paired values at the beginning of the analysis, and use those differences as our values of interest.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclimate70 <- climate70 |>\n  mutate(dx90_diff = dx90_2018 - dx90_1948)\n\nclimate70 |>\n   select(station, latitude, longitude, contains(\"dx90\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 197 × 6\n   station     latitude longitude dx90_1948 dx90_2018 dx90_diff\n   <fct>          <dbl>     <dbl>     <int>     <int>     <int>\n 1 USC00203823     41.9     -84.6        11        16         5\n 2 USC00276818     44.3     -71.3         1         1         0\n 3 USC00186620     39.4     -79.4         4         1        -3\n 4 USC00331890     40.2     -81.9        18        15        -3\n 5 USC00235987     37.8     -94.4        59        51        -8\n 6 USC00395691     45.6    -100.         39        18       -21\n 7 USC00219046     43.8     -94.2        23        17        -6\n 8 USW00003812     35.4     -82.5        17         3       -14\n 9 USC00047643     38.5    -122.         46        65        19\n10 USW00013896     34.7     -87.6        67       104        37\n# ℹ 187 more rows\n```\n\n\n:::\n:::\n\n\nAnd then visualize these differences:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(climate70, aes(x = dx90_diff)) +\n  geom_histogram()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-17-climate-sa_files/figure-html/plot-diff-1.png){width=576}\n:::\n:::\n\n\nWe calculate the observed statistic in the paired setting in the same way that we would outside of the paired setting. Using `specify()` and `calculate()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobs_stat <- climate70 |> \n  specify(response = dx90_diff) |> \n  calculate(stat = \"mean\")\n\nobs_stat\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nResponse: dx90_diff (numeric)\n# A tibble: 1 × 1\n   stat\n  <dbl>\n1  2.90\n```\n\n\n:::\n:::\n\n\nNow, we want to compare this statistic to a null distribution, generated under the assumption that the true difference was actually zero, to get a sense of how likely it would be for us to see this observed difference or something more extreme.\n\nTests for paired data are carried out via the `null = \"paired independence\"` argument to `hypothesize()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1129)\n\nnull_dist <- climate70 |> \n   specify(response = dx90_diff) |> \n   hypothesize(null = \"paired independence\") |>\n   generate(reps = 1000, type = \"permute\") |>\n   calculate(stat = \"mean\")\n   \nvisualize(null_dist)\n```\n\n::: {.cell-output-display}\n![](ae-17-climate-sa_files/figure-html/null-dist-1.png){width=576}\n:::\n:::\n\n\nFor each replicate, `generate()` carries out `type = \"permute\"` with `null = \"paired independence\"` by:\n\n-   Randomly sampling a vector of signs (i.e., -1 or 1), probability 0.5 for either, with length equal to the input data, and\n-   Multiplying the response variable by the vector of signs, \"flipping\" the observed values for a random subset of value in each replicate\n\nTo get a sense for what this distribution looks like, and where our observed statistic falls, we can use `visualize()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisualize(null_dist) + \n  shade_p_value(obs_stat, direction = \"two-sided\")\n```\n\n::: {.cell-output-display}\n![](ae-17-climate-sa_files/figure-html/p-value-viz-1.png){width=576}\n:::\n:::\n\n\nThen, we calculate the p-value:\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_value <- null_dist |>\n  get_p_value(obs_stat, direction = \"two-sided\")\n\np_value\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1   0.016\n```\n\n\n:::\n:::\n",
    "supporting": [
      "ae-17-climate-sa_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}